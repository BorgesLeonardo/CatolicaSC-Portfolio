{
  "openapi": "3.0.3",
  "info": {
    "title": "CatolicaSC Portfolio API",
    "version": "1.0.0",
    "description": "Especificação OpenAPI (Swagger) dos endpoints do backend."
  },
  "servers": [
    { "url": "/" },
    { "url": "https://render-backend-hb07.onrender.com" }
  ],
  "tags": [
    { "name": "Health" },
    { "name": "Projects" },
    { "name": "Project Images" },
    { "name": "Project Videos" },
    { "name": "Contributions" },
    { "name": "Subscriptions" },
    { "name": "Categories" },
    { "name": "Comments" },
    { "name": "Me" },
    { "name": "Connect" },
    { "name": "Events" },
    { "name": "Stats" },
    { "name": "Webhooks" }
  ],
  "paths": {
    "/api/health": {
      "get": {
        "tags": ["Health"],
        "summary": "Health check",
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/health": {
      "get": {
        "tags": ["Health"],
        "summary": "Health check (sem prefixo)",
        "responses": { "200": { "description": "OK" } }
      }
    },
    "/api/projects": {
      "get": {
        "tags": ["Projects"],
        "summary": "Listar projetos",
        "parameters": [
          { "in": "query", "name": "q", "schema": { "type": "string" }, "description": "Busca por título" },
          { "in": "query", "name": "ownerId", "schema": { "type": "string" }, "description": "ID do dono (Clerk)" },
          { "in": "query", "name": "active", "schema": { "type": "boolean" }, "description": "Filtra projetos com deadline ativo" },
          { "in": "query", "name": "page", "schema": { "type": "integer", "minimum": 1 } },
          { "in": "query", "name": "pageSize", "schema": { "type": "integer", "minimum": 1, "maximum": 100 } }
        ],
        "responses": { "200": { "description": "Lista de projetos" } }
      },
      "post": {
        "tags": ["Projects"],
        "summary": "Criar projeto",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "in": "header", "name": "Idempotency-Key", "schema": { "type": "string" }, "required": false, "description": "Chave de idempotência" }
        ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object" } } } },
        "responses": { "201": { "description": "Projeto criado" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/projects/mine": {
      "get": {
        "tags": ["Projects"],
        "summary": "Meus projetos",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "Lista de projetos do usuário" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/projects/{id}": {
      "get": {
        "tags": ["Projects"],
        "summary": "Detalhar projeto",
        "parameters": [ { "in": "path", "name": "id", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "Detalhe do projeto" }, "404": { "description": "Não encontrado" } }
      },
      "patch": {
        "tags": ["Projects"],
        "summary": "Atualizar projeto",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "in": "path", "name": "id", "required": true, "schema": { "type": "string" } } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object" } } } },
        "responses": { "200": { "description": "Projeto atualizado" }, "401": { "description": "Não autorizado" }, "404": { "description": "Não encontrado" } }
      },
      "delete": {
        "tags": ["Projects"],
        "summary": "Excluir projeto (soft delete)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "in": "path", "name": "id", "required": true, "schema": { "type": "string" } } ],
        "responses": { "204": { "description": "Excluído" }, "401": { "description": "Não autorizado" }, "404": { "description": "Não encontrado" } }
      }
    },
    "/api/projects/update-stats": {
      "post": {
        "tags": ["Projects"],
        "summary": "Atualizar estatísticas de projetos",
        "responses": { "202": { "description": "Atualização disparada" } }
      }
    },
    "/api/projects/{projectId}/images": {
      "post": {
        "tags": ["Project Images"],
        "summary": "Upload de imagens do projeto",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "in": "path", "name": "projectId", "required": true, "schema": { "type": "string" } } ],
        "requestBody": { "required": true, "content": { "multipart/form-data": { "schema": { "type": "object" } } } },
        "responses": { "201": { "description": "Imagens enviadas" }, "401": { "description": "Não autorizado" } }
      },
      "get": {
        "tags": ["Project Images"],
        "summary": "Listar imagens do projeto",
        "parameters": [ { "in": "path", "name": "projectId", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "Lista de imagens" } }
      }
    },
    "/api/projects/{projectId}/images/{imageId}": {
      "delete": {
        "tags": ["Project Images"],
        "summary": "Deletar imagem do projeto",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "in": "path", "name": "projectId", "required": true, "schema": { "type": "string" } },
          { "in": "path", "name": "imageId", "required": true, "schema": { "type": "string" } }
        ],
        "responses": { "204": { "description": "Imagem removida" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/projects/{projectId}/images/reorder": {
      "put": {
        "tags": ["Project Images"],
        "summary": "Reordenar imagens do projeto",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "in": "path", "name": "projectId", "required": true, "schema": { "type": "string" } } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object" } } } },
        "responses": { "200": { "description": "Ordem atualizada" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/projects/{projectId}/video": {
      "post": {
        "tags": ["Project Videos"],
        "summary": "Upload de vídeo do projeto",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "in": "path", "name": "projectId", "required": true, "schema": { "type": "string" } } ],
        "requestBody": { "required": true, "content": { "multipart/form-data": { "schema": { "type": "object" } } } },
        "responses": { "201": { "description": "Vídeo enviado" }, "401": { "description": "Não autorizado" } }
      },
      "delete": {
        "tags": ["Project Videos"],
        "summary": "Deletar vídeo do projeto",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "in": "path", "name": "projectId", "required": true, "schema": { "type": "string" } } ],
        "responses": { "204": { "description": "Vídeo removido" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/contributions/checkout": {
      "post": {
        "tags": ["Contributions"],
        "summary": "Criar checkout de contribuição",
        "security": [{ "bearerAuth": [] }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object" } } } },
        "responses": { "200": { "description": "Sessão de checkout criada" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/contributions/project/{projectId}": {
      "get": {
        "tags": ["Contributions"],
        "summary": "Listar contribuições de um projeto",
        "parameters": [ { "in": "path", "name": "projectId", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "Lista de contribuições" } }
      }
    },
    "/api/contributions/project/{projectId}/has-contributions": {
      "get": {
        "tags": ["Contributions"],
        "summary": "Verificar se projeto possui contribuições",
        "parameters": [ { "in": "path", "name": "projectId", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "Indicador de existência" } }
      }
    },
    "/api/subscriptions/checkout": {
      "post": {
        "tags": ["Subscriptions"],
        "summary": "Criar checkout de assinatura",
        "security": [{ "bearerAuth": [] }],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object" } } } },
        "responses": { "200": { "description": "Sessão criada" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/subscriptions/{id}": {
      "delete": {
        "tags": ["Subscriptions"],
        "summary": "Cancelar assinatura",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "in": "path", "name": "id", "required": true, "schema": { "type": "string" } } ],
        "responses": { "204": { "description": "Assinatura cancelada" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/categories": {
      "get": {
        "tags": ["Categories"],
        "summary": "Listar categorias",
        "responses": { "200": { "description": "Lista de categorias" } }
      }
    },
    "/api/categories/{id}": {
      "get": {
        "tags": ["Categories"],
        "summary": "Detalhar categoria",
        "parameters": [ { "in": "path", "name": "id", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "Categoria" }, "404": { "description": "Não encontrada" } }
      }
    },
    "/api/projects/{id}/comments": {
      "post": {
        "tags": ["Comments"],
        "summary": "Criar comentário em projeto",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "in": "path", "name": "id", "required": true, "schema": { "type": "string" } } ],
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object" } } } },
        "responses": { "201": { "description": "Comentário criado" }, "401": { "description": "Não autorizado" } }
      },
      "get": {
        "tags": ["Comments"],
        "summary": "Listar comentários do projeto",
        "parameters": [ { "in": "path", "name": "id", "required": true, "schema": { "type": "string" } } ],
        "responses": { "200": { "description": "Lista de comentários" } }
      }
    },
    "/api/comments/{commentId}": {
      "delete": {
        "tags": ["Comments"],
        "summary": "Remover comentário",
        "security": [{ "bearerAuth": [] }],
        "parameters": [ { "in": "path", "name": "commentId", "required": true, "schema": { "type": "string" } } ],
        "responses": { "204": { "description": "Comentário removido" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/me/metrics": {
      "get": {
        "tags": ["Me"],
        "summary": "KPIs do usuário autenticado",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "Métricas" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/me/contributions/timeseries": {
      "get": {
        "tags": ["Me"],
        "summary": "Série temporal de contribuições do usuário",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "Série temporal" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/me/contributions/list": {
      "get": {
        "tags": ["Me"],
        "summary": "Lista de contribuições do usuário",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "Lista de contribuições" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/me/campaigns/metrics": {
      "get": {
        "tags": ["Me"],
        "summary": "Métricas das campanhas do usuário",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "Métricas" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/me/campaigns/list": {
      "get": {
        "tags": ["Me"],
        "summary": "Lista paginada de campanhas do usuário",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "Lista de campanhas" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/me/payouts": {
      "get": {
        "tags": ["Me"],
        "summary": "Payouts (se aplicável)",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "Payouts" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/me/subscriptions": {
      "get": {
        "tags": ["Me"],
        "summary": "Minhas assinaturas (recorrências)",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "Assinaturas" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/connect/onboard": {
      "post": {
        "tags": ["Connect"],
        "summary": "Iniciar onboarding do Connect",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "Link de onboarding" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/me/connect/status": {
      "get": {
        "tags": ["Connect"],
        "summary": "Status do Connect do usuário",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "Status" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/me/connect/dashboard-link": {
      "get": {
        "tags": ["Connect"],
        "summary": "Link de dashboard do Connect",
        "security": [{ "bearerAuth": [] }],
        "responses": { "200": { "description": "Link gerado" }, "401": { "description": "Não autorizado" } }
      }
    },
    "/api/events": {
      "get": {
        "tags": ["Events"],
        "summary": "Stream de eventos (SSE)",
        "responses": {
          "200": {
            "description": "Stream iniciado",
            "content": { "text/event-stream": { "schema": { "type": "string" } } }
          }
        }
      }
    },
    "/api/stats/platform": {
      "get": {
        "tags": ["Stats"],
        "summary": "Métricas públicas da plataforma",
        "responses": { "200": { "description": "Métricas da plataforma" } }
      }
    },
    "/api/webhooks/stripe": {
      "post": {
        "tags": ["Webhooks"],
        "summary": "Webhook Stripe",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "type": "object" } } } },
        "responses": { "200": { "description": "Recebido" } }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": { "type": "http", "scheme": "bearer", "bearerFormat": "JWT" }
    }
  }
}




